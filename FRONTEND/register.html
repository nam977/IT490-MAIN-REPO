<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<title>IT-490-001 Registration Page</title>
		<link rel = "stylesheet" href = "https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
	</head>

	<body class = "has-background-light">
		<section class="section">
			<div class = "container">
				<div class = "columnns is-centered">
					<div class = "column is-half">
						<h1 class = "titlee is-3 has-text-centered">Register Below</h1>
							<div class = "box"></div>
								<form id="registerForm">
									<div class = "field">
										<div class = "control has-icons-left">
											<input class = "input" type="text" name="username" id="username" placeholder="username" required>
											<span class = "icon is-small is-left">
												<i class = "fas fa-user"></i>
											</span>
										</div>
									</div>

									<div class = "field">
										<div class = "control has-icons-left">
											<input type="password" name="password" id="password" placeholder="password" required>
											<span class = "icon is-small is-left">
												<i class = "fas fa-lock"></i>
											</span>
										</div>
									</div>

									<div class = "field">
										<div class = "control has-icons-left">
											<input type="email" for="email" name="email" placeholder="email" id="email" required>
											<span class = "icon is-small is-left">
												<i class = "fas fa-envelope"></i>
											</span>
										</div>
									</div>
									
									<input type="hidden" name="type" value="register">
									<div class = "field mt-5">
										<div class = "control">
											<input class = "button is-primary is fullwidth" type="submit" value="register">
										</div>
									</div>
								</form>
								<p id="textResponse" class = "notification is-light mt-4">awaiting response</p>
							</div>
					</div>
				</div>
			</div>
		</section>
	<script defer src = "https://use.fontawesome.com/releases/v5.15.4/js/all.js"></script>
	<script>
			// You can add JavaScript here if needed for form validation or other purposes
		document.addEventListener("DOMContentLoaded", function() {
			const output = document.getElementById("textResponse");
			function HandleRegisterResponse(xhr){
				if (xhr.status !== 200){
					output.textContent = "Server Error: " + xhr.status + " " + xhr.statusText;
					return;
				}
				
				let res;

				try {
					res = JSON.parse(xhr.responseText);
				} catch {
					output.textContent = "Error parsing server response.";
					return;
				}

				const success =
					(res.status && res.status.toLowerCase() === "success") ||
					(res.returnCode === 0);

				if (success) {
					output.textContent = "Registration successful! Redirecting back to main page.";
					window.location.href = "index.html";
				} else {
					output.textContent = "Registration failed: " + (res.message || "Unknown error");
				}
			}
			
			function SendRegisterRequestJSON(registerData){
				var xhr = new XMLHttpRequest();
				xhr.open("POST","mqGateway.php");
				xhr.setRequestHeader("Content-Type","application/json");
				xhr.onreadystatechange = function (){
					if (this.readyState === 4) HandleRegisterResponse(this);
				};
				xhr.send(JSON.stringify(registerData));
			}

		document.getElementById("registerForm").addEventListener("submit", (e) => {
			e.preventDefault(); // Prevent the default form submission
			const username = document.getElementById("username").value.trim();
			const password = document.getElementById("password").value;
			const email = document.getElementById("email").value.trim();
			SendRegisterRequestJSON({ 
				type: "register", 
				username,
				password,
				email
			});
		});
	});
	</script>
	</body>
</html>
